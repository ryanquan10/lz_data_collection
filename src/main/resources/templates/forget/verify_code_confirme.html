<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>login-register</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <META name="content-type" content="text/html; charset=UTF-8">
    <LINK href="${request.contextPath}/statics/css/register-login.css" rel="stylesheet">
    <SCRIPT src="${request.contextPath}/statics/bootstrap-3.3.7/static/js/jquery-3.5.1.min.js"></SCRIPT>
    <script src="${request.contextPath}/statics/js/particles.js"></script>
    <SCRIPT src="${request.contextPath}/statics/js/mycommon.js"></SCRIPT>
    <script type="text/javascript">


        // $(function(){
        //     getVerifiCode();
        // });
        // //获取email 验证码
        // function getVerifiCode() {
        //     $("#captchaImg").prop('src','${request.contextPath}/captcha?t=' + new Date().getTime());
        // }

        function checkEmailVerifyCode(){
            $.ajax({
                type:"post",
                dataType:"json",
                contentType:"application/json; charset=UTF-8",
                url:"${request.contextPath}/forget/checkEmailKaptcha",
                data: JSON.stringify($("#verifyForm").serializeObject()),
                success: function(data,textStatus,xhr){
                    console.log(data)

                 if(data.code==0){
                     location.href="${request.contextPath}/forget/new_pwd.html"
                 }
                }
            })
        }


        function sendCaptcha(obj){
            var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
            var email=$("#email").val();
            if(!reg.test(email)){ //正则验证不通过，格式不对
                //alert("邮箱地址格式不正确，请重新输入!");
                ui = '<ul><li>邮箱地址格式不正确，请重新输入!</li></ul>';
                $('#jsLoginTips').append(ui);
                $("#email").focus();
                return false;
            }

            console.log("${request.contextPath}/sendCaptcha");

            var wait=60;
            function settime(o) {
                if (wait == 0) {
                    o.removeAttribute("disabled");
                    o.innerHTML="重新发送";
                    wait = 60;
                } else {
                    o.setAttribute("disabled", true);
                    o.innerHTML="重新发送(" + wait + ")";
                    wait--;
                    setTimeout(function() {settime(o)},1000)
                }
            }


            $.ajax({
                type: 'put',
                 // dataType: 'json',
                // contentType: 'application/json; charset=UTF-8',
                data: {email:email},//JSON.stringify({email:email}),//formData,
                url:'${request.contextPath}/sendCaptcha',
                // traditional : true,
                async:false,//true为异步，false为同步
                error: function (xhr,textStatus,errorThrown) {
                    console.log("There was an error processing this page.  textStatus "+textStatus+"   errorThrown "+errorThrown);
                    return false;
                },
                success:function(data){//alert("返回结果："+ data);
                    //请求成功时
                    console.log(data);
                    if(data.code != 0){
                        $('#jsLoginTips').empty();
                        var ui = '<ul><li> 已经发送 请检查邮箱 </li></ul>';
                        $('#jsLoginTips').append(ui);
                        return false;
                    }else{
                        settime(obj);
                    }
                }
            });
        }

        // $("#email").prop('checked', true);

        //
        // function verifyCodeSubmit(){
        //
        //     if (document.getElementById("id_captcha_1").value == ''){
        //         $('#jsLoginTips').empty();
        //         ui = '<ul><li>验证码不能为空</li></ul>';
        //         $('#jsLoginTips').append(ui);
        //         return false;
        //     }
        //
        //     $.ajax({
        //         type: 'post',
        //         dataType: 'json',
        //         contentType: 'application/json; charset=UTF-8',
        //         data: JSON.stringify($("#verifyForm").serializeObject()),//JSON.stringify(getFormData($("#dataForm"))),//formData,
        //         url:'${request.contextPath}/login',
        //         async:false,//true为异步，false为同步
        //         error: function () {console.log("error");
        //             //console.log(output);
        //             alert("There was an error processing this page.");
        //             return false;
        //         },
        //         success:function(data){//alert("返回结果："+ data);
        //             //请求成功时
        //             console.log(data);
        //             if(data.code !== 0){
        //                 //alert("登录出错：" + data.msg);
        //                 $('#jsLoginTips').empty();
        //                 var ui = '<ul><li>'+data.msg+'</li></ul>';
        //                 $('#jsLoginTips').append(ui);
        //                 getVerifiCode();
        //                 return false;
        //             }else{
        //                 window.location.href ='new_pwd.html';
        //             }
        //         }
        //     });
        //     //return false;
        // }
    </script>
</head>
<body>

<div id="box"><canvas width="1920" height="902" class="particles-js-canvas-el" style="width: 100%; height: 100%;"></canvas></div>
<div class="cent-box">
    <div class="cent-box-header">
        <!--		<h1 class="main-title hide">highy</h1>-->  <!--它歪了,不知道怎么回事 注释掉-->
    </div>

    <div class="cont-main clearfix">
<!--        <div class="index-tab">-->
<!--            &lt;!&ndash;           &ndash;&gt;-->
<!--            <div class=" index-slide-nav">-->
<!--                <a class="active" href="${request.contextPath}/login.html">登录</a>-->
<!--                <a href="${request.contextPath}/toregister">注册</a>-->
<!--                <div class="slide-bar"></div>-->
<!--            </div>-->
<!--        </div>-->



        验证方式
        <form name="verifyForm" id="verifyForm" method="post" autocomplete="off">
            <input name="csrfmiddlewaretoken" type="hidden" value='${Session["csrfmiddlewaretoken"]?default(" ")}'>

            <div class="login form">
                <div class="group-ipt email">
                    <input name="email" class="ipt" id="email" required="true" type="radio" placeholder="邮箱地址" checked="checked" value='${Session["email"]?default(" ")}'>邮箱地址: <span> ${Session["email"]?default("a@qq.com")} </span>  </input>
                </div>
                <div class="group">


                    <div class="group-ipt password">
                        <input name="verify_code" class="ipt" id="verify_code" required="true" type="text" placeholder="输入您的验证码" value="">
                    </div>
<!--                    <div class="group-ipt verify">-->
<!--                        <input name="captcha" id="id_captcha_1" required="true" spellcheck="false" type="text" placeholder="请输入验证码" autocomplete="off" autocorrect="off" autocapitalize="off">-->
<!--                        <img id="captchaImg" class="captcha" onclick="getVerifiCode();" alt="captcha" src=""> <input name="captcha_0" id="id_captcha_0" type="hidden" value="acb62e9f26f21160454bf9063509ede8dd99f9ee">-->
<!--                    </div>-->
                    <div class="login-form-tips" id="jsLoginTips"></div>
                </div>
            </div>

            <div class="button">
                <button type="button"  id="confirm_button" onclick="checkEmailVerifyCode()">确认</button>
<!--                class="login-btn register-btn"-->
                <!--                <a href="${request.contextPath}getbackpwd.html"> 忘记密码?(找回密码) </a>-->
                <button type="button"  id="sendCaptcha_button" onclick="sendCaptcha(this)">发送验证码</button>
<!--                class="login-btn register-btn"-->
                <!--                <a href="${request.contextPath}getbackpwd.html"> 忘记密码?(找回密码) </a>-->
            </div>


        </form>

<!--        <div class="remember clearfix">-->
<!--            <label class="remember-me"><span class="icon"><span class="zt"></span></span><input name="remember-me" class="remember-mecheck" id="remember-me" type="checkbox" checked="">记住我</label>-->
<!--            <label class="forgot-password">-->
<!--                <a href="${request.contextPath}/forget/getbackpwd.html">忘记密码？</a>-->
<!--            </label>-->
<!--        </div>-->
    </div>
</div>

</body>
</html>