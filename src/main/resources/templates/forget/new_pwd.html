<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>login-register</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <META name="content-type" content="text/html; charset=UTF-8">
    <LINK href="${request.contextPath}/statics/css/register-login.css" rel="stylesheet">
    <SCRIPT src="${request.contextPath}/statics/bootstrap-3.3.7/static/js/jquery-3.5.1.min.js"></SCRIPT>
    <script src="${request.contextPath}/statics/js/particles.js"></script>
    <SCRIPT src="${request.contextPath}/statics/js/mycommon.js"></SCRIPT>
    <script type="text/javascript">

        // 登录操作：
        function pwdSubmit(){

            //password1

            if (document.getElementById("password1").value == ''){
                $('#jsLoginTips').empty();
                ui = '<ul><li>验证码不能为空</li></ul>';
                $('#jsLoginTips').append(ui);
                return false;
            }

            var password1 = document.getElementById("password1").value;
            var password2 = document.getElementById("password2").value;

            if(password1!=password2){
                $('#jsLoginTips').empty();
                ui = '<ul><li>两次密码不一致</li></ul>';
                $('#jsLoginTips').append(ui);
                return false;
            }
            var res = {};

            //字段 只需要 账号 和 密码  和 token
            res.password=password2;
            res.email="${user.email}";
            res.csrfmiddlewaretoken=$("#csrfmiddlewaretoken").val();

            console.log(res);

            //var formData = $("#loginForm").serialize();
            //alert(JSON.stringify($("#loginForm").serializeObject()));
            $.ajax({
                type: 'post',
                dataType: 'json',
                contentType: 'application/json; charset=UTF-8',

                data: JSON.stringify(res),//JSON.stringify(getFormData($("#dataForm"))),//formData,
                url:'${request.contextPath}/forget/updatePassword',
                async:false,//true为异步，false为同步
                error: function () {console.log("error");
                    //console.log(output);
                    alert("There was an error processing this page.");
                    return false;
                },
                success:function(data){//alert("返回结果："+ data);
                    //请求成功时
                    console.log(data);
                    if(data.code !== 0){
                        //alert("登录出错：" + data.msg);
                        $('#jsLoginTips').empty();
                        var ui = '<ul><li>'+data.msg+'</li></ul>';
                        $('#jsLoginTips').append(ui);

                        return false;
                    }else{// 修改成功返回主页

                        window.location.href ='http://algaemedical.com/dataAnalysis';
                    }
                }
            });
            //return false;
        }
    </script>
</head>
<body>

<div id="box"><canvas width="1920" height="902" class="particles-js-canvas-el" style="width: 100%; height: 100%;"></canvas></div>
<div class="cent-box">
    <div class="cent-box-header">
        <!--		<h1 class="main-title hide">highy</h1>-->  <!--它歪了,不知道怎么回事 注释掉-->
    </div>


        <form name="loginForm" id="loginForm" method="post" autocomplete="off">
            <input id="csrfmiddlewaretoken" name="csrfmiddlewaretoken" type="hidden" value='${Session["csrfmiddlewaretoken"]?default(" ")}'>
            <div class="login form">
                <div class="group">
                    <div style="display:none">
<!--                       {Session['email']}?default('a@unknown.com')-->

                        <input name="email" id="email" value="${user.email}$"></input>
                    </div>
                    <div class="group-ipt password">
                        <input name="password1" class="ipt" id="password1" required="true" type="password" placeholder="输入您的新密码" value="">
                    </div>
                    <div class="group-ipt password">
                        <input name="password2" class="ipt" id="password2" required="true" type="password" placeholder="再次确认" value="">
                    </div>
<!--                    <div class="group-ipt verify">-->
<!--                        <input name="captcha" id="id_captcha_1" required="true" spellcheck="false" type="text" placeholder="请输入验证码" autocomplete="off" autocorrect="off" autocapitalize="off">-->
<!--                        <img id="captchaImg" class="captcha" onclick="getVerifiCode();" alt="captcha" src=""> <input name="captcha_0" id="id_captcha_0" type="hidden" value="acb62e9f26f21160454bf9063509ede8dd99f9ee">-->
<!--                    </div>-->
                    <div class="login-form-tips" id="jsLoginTips"></div>
                </div>
            </div>

            <div class="button">
                <button type="button" class="login-btn register-btn" id="button" onclick="pwdSubmit()">确认</button>
                <!--                <a href="${request.contextPath}getbackpwd.html"> 忘记密码?(找回密码) </a>-->
            </div>

        </form>

<!--        <div class="remember clearfix">-->
<!--            <label class="remember-me"><span class="icon"><span class="zt"></span></span><input name="remember-me" class="remember-mecheck" id="remember-me" type="checkbox" checked="">记住我</label>-->
<!--            <label class="forgot-password">-->
<!--                <a href="${request.contextPath}/forget/getbackpwd.html">忘记密码？</a>-->
<!--            </label>-->
<!--        </div>-->

    </div>
</div>

</body>
</html>