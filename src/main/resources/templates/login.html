<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>login-register</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<META name="content-type" content="text/html; charset=UTF-8">
<LINK href="${request.contextPath}/statics/css/register-login.css" rel="stylesheet">
<SCRIPT src="${request.contextPath}/statics/bootstrap-3.3.7/static/js/jquery-3.5.1.min.js"></SCRIPT>
<script src="${request.contextPath}/statics/js/particles.js"></script>
<SCRIPT src="${request.contextPath}/statics/js/mycommon.js"></SCRIPT>
<script type="text/javascript">
// 获取验证码
/* $(function(){
	
	$("#captchaImg").prop('src','${request.contextPath}/captcha?t=' + new Date().getTime());
	/* $.ajax({
        type: 'get',
        //dataType: 'json',
        url:'${request.contextPath}/captcha?t=' + new Date().getTime(),
        error: function () {console.log("error");
            //console.log(output);
            alert("There was an error processing this page.");
            return false;
        },
        complete: function (output) {
        	console.log("complete");
        },
        success:function(data){
  	        //请求成功时
        	console.log(data);
  	        if(data.status=="success"){
  	        	var imgPath = data.bizContent;
  	        	//alert("生成图片路径：" + imgPath);
  	        	//$("#outputImg").src=imgPath;
  	        	$("#outputImg").attr("src","http://www.scisy.org/"+imgPath);
  	        }else{
  	        	alert("出现异常：" + data.message);
  	        }
  	    } 
    });
}); */

$(function(){
	getVerifiCode();
});
//获取验证码
function getVerifiCode() {
	$("#captchaImg").prop('src','${request.contextPath}/captcha?t=' + new Date().getTime());
}

// 登录操作：
function loginSubmit(){
	//if (!$("#loginForm").valid()) return;
	var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
	// 
	var email=$("#username").val();
	if(!reg.test(email)){ //正则验证不通过，格式不对
　　　　alert("邮箱地址格式不正确，请重新输入!");
	   $("#email").focus();
　　　　return false;
　　}
	if (document.getElementById("id_captcha_1").value == ''){
        $('#jsLoginTips').empty();
        ui = '<ul><li>验证码不能为空</li></ul>';
        $('#jsLoginTips').append(ui);
        return false;
    }
	//var formData = $("#loginForm").serialize();
	//alert(JSON.stringify($("#loginForm").serializeObject()));
	$.ajax({
        type: 'post',
        dataType: 'json',
        contentType: 'application/json; charset=UTF-8',
        data: JSON.stringify($("#loginForm").serializeObject()),//JSON.stringify(getFormData($("#dataForm"))),//formData,
        url:'${request.contextPath}/login',
        async:false,//true为异步，false为同步
        error: function () {console.log("error");
            //console.log(output);
            alert("There was an error processing this page.");
            return false;
        },
        success:function(data){//alert("返回结果："+ data);
  	        //请求成功时
        	console.log(data);
  	        if(data.code !== 0){
  	        	//alert("登录出错：" + data.msg);
  	        	$('#jsLoginTips').empty();
  	            var ui = '<ul><li>'+data.msg+'</li></ul>';
  	            $('#jsLoginTips').append(ui);
  	          	getVerifiCode();
  	            return false;
  	        }else{// 登录成功进入主业
  	            if(data.data){
                    window.location.href =data.data;
                }
  	        	window.location.href ='plot_basic.html';
  	        }
  	    } 
    });
	//return false;
}
</script>
</head>
<body>

<div id="box"><canvas width="1920" height="902" class="particles-js-canvas-el" style="width: 100%; height: 100%;"></canvas></div>
<div class="cent-box">
	<div class="cent-box-header">
		<h1 class="main-title hide">highy</h1>
	</div>

	<div class="cont-main clearfix">
		<div class="index-tab">
			<div class="index-slide-nav">
				<a class="active" href="${request.contextPath}/login.html">登录</a>
				<a href="${request.contextPath}/toregister">注册</a>
				<div class="slide-bar"></div>				
			</div>
		</div>

        <form name="loginForm" id="loginForm" method="post" autocomplete="off">
            <input name="csrfmiddlewaretoken" type="hidden" value="7DQ7mp6EF21XekDuSgqscUaDp4MBl4IApc1GjAwaQ0bVVMo3rqF3xnkbHQq4NqsD">

            <div class="login form">
                <div class="group">
                    <div class="group-ipt email">
                        <input name="username" class="ipt" id="username" required="true" type="email" placeholder="邮箱地址" value="">
                    </div>
                    <div class="group-ipt password">
                        <input name="password" class="ipt" id="password" required="true" type="password" placeholder="输入您的登录密码" value="">
                    </div>
                    <div class="group-ipt verify">
                        <input name="captcha" id="id_captcha_1" required="true" spellcheck="false" type="text" placeholder="请输入验证码" autocomplete="off" autocorrect="off" autocapitalize="off">
<img id="captchaImg" class="captcha" onclick="getVerifiCode();" alt="captcha" src=""> <input name="captcha_0" id="id_captcha_0" type="hidden" value="acb62e9f26f21160454bf9063509ede8dd99f9ee">
                    </div>
                    <div class="login-form-tips" id="jsLoginTips"></div>
                </div>
            </div>

            <div class="button">
                <button type="button" class="login-btn register-btn" id="button" onclick="loginSubmit()">登录</button>
            </div>

        </form>

		<!-- <div class="remember clearfix">
			<label class="remember-me"><span class="icon"><span class="zt"></span></span><input name="remember-me" class="remember-mecheck" id="remember-me" type="checkbox" checked="">记住我</label>
			<label class="forgot-password">
				<a href="/forget/">忘记密码？</a>
			</label>
		</div> -->
	</div>
</div>

</body>
</html>