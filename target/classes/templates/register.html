<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>login-register</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<META name="content-type" content="text/html; charset=UTF-8">
<LINK href="${request.contextPath}/statics/css/register-login.css" rel="stylesheet">
<SCRIPT src="${request.contextPath}/statics/bootstrap-3.3.7/static/js/jquery-3.5.1.min.js"></SCRIPT>
<script src="${request.contextPath}/statics/js/particles.js"></script>
<!-- <script src="${request.contextPath}/statics/js/background.js" type="text/javascript"></script> -->
<SCRIPT src="${request.contextPath}/statics/js/mycommon.js"></SCRIPT>
</head>
<body>
<div id="box"><canvas width="1920" height="902" class="particles-js-canvas-el" style="width: 100%; height: 100%;"></canvas></div>
<div class="cent-box register-box">
	<div class="cent-box-header">
		<h1 class="main-title hide">highy</h1>
	</div>

	<div class="cont-main clearfix">
		<div class="index-tab">
			<div class="index-slide-nav">
				<a href="${request.contextPath}/login.html">登录</a>
				<a class="active" href="${request.contextPath}/toregister">注册</a>
				<div class="slide-bar slide-bar1"></div>				
			</div>
		</div>

        <form id="registerForm" name="registerForm" action="/register/" method="post" autocomplete="off">
            <input name="csrfmiddlewaretoken" type="hidden" value="ICJ3J7BbRH7q8xEWbZQJA682hDRKzddk0bUCGi1H2FhoPZpvK95kVziAzpvd1zXn">

            <div class="login form">
                <div class="group">
                    <div class="group-ipt email">
                        <input name="username" class="ipt" id="username" required="true" type="email" placeholder="邮箱地址（必填）" value="">
                         <button type="button" onclick="sendCaptcha(this);" value="发送验证码" >发送验证码</button>
                    </div>
                    <div class="group-ipt verify">
                        <input name="captcha" id="id_captcha_1" required="true" spellcheck="false" type="text" placeholder="请输入验证码" >
                    </div>
                    <div class="group-ipt password">
                        <input name="password" class="ipt" id="password" required="true" type="password" placeholder="设置登录密码（必填）" value="">
                    </div>
                    <div class="group-ipt password1">
                        <input class="ipt" id="password1" required="true" type="password" placeholder="重复密码（必填）" value="">
                    </div>
                    <!-- <div class="group-ipt other">
                        <input name="danwei" class="ipt" id="danwei" type="text" placeholder="单位名称（可选）" value="">
                    </div>
                    <div class="group-ipt other">
                        <input name="yanjiufangxiang" class="ipt" id="yanjiufangxiang" type="text" placeholder="研究方向（可选）" value="">
                    </div>
                    <div class="group-ipt other">
                        <input name="qq" class="ipt" id="qq" type="text" placeholder="QQ（可选）" value="">
                    </div>
                    <div class="group-ipt other">
                        <input name="weixin" class="ipt" id="weixin" type="text" placeholder="微信（可选）" value="">
                    </div> -->
                    <!--  <div class="group-ipt verify">
                        <input name="captcha" id="id_captcha_1" required="true" spellcheck="false" type="text" placeholder="请输入验证码" autocomplete="off" autocorrect="off" autocapitalize="off">
<img id="captchaImg" class="captcha" onclick="getVerifiCode();" alt="captcha" src=""> <input name="captcha_0" id="id_captcha_0" type="hidden" value="acb62e9f26f21160454bf9063509ede8dd99f9ee">
                    </div> -->
                    <div class="login-form-tips" id="jsLoginTips"></div>
                </div>
            </div>

            <div class="button">
			    <button class="login-btn register-btn" id="button" type="button" onclick="registerSubmit()">注册</button>
		    </div>
        </form>

	</div>
</div>
<br>
<br>


<script>
    /* $("#button").click(function () {
         if (document.getElementById("id_captcha_1").value == ''){
             $('#jsLoginTips').empty();
             ui = '<ul><li>验证码不能为空</li></ul>';
             $('#jsLoginTips').append(ui);
             return false;
         }
     });


    $('.captcha').click(function () {
        $.getJSON("/captcha/refresh/", function (result) {
            $('.captcha').attr('src', result['image_url']);
            $('#id_captcha_0').val(result['key'])
        });
    });

	$(".login-btn").click(function(){
		var email = $("#email").val();
		var password = $("#password").val();
		var verify = $("#verify").val();
		// $.ajax({
		// url: 'http://www.zrong.me/home/index/userLogin',
		// type: 'post',
		// jsonp: 'jsonpcallback',
  //       jsonpCallback: "flightHandler",
		// async: false,
		// data: {
		// 	'email':email,
		// 	'password':password,
		// 	'verify':verify
		// },
		// success: function(data){
		// 	info = data.status;
		// 	layer.msg(info);
		// }
		// })

	}) */
	
	// 重新发送验证码60s倒计时
	var wait=60;
	function settime(o) {
		if (wait == 0) {
			o.removeAttribute("disabled");  
			o.innerHTML="重新发送";
		  	wait = 60;
	 	} else { 
		  	o.setAttribute("disabled", true);
	  		o.innerHTML="重新发送(" + wait + ")";
	  		wait--;
	  		setTimeout(function() {settime(o)},1000)
	 	}
	}
	
	// 发送验证码
	function sendCaptcha(obj){
		var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
		var email=$("#username").val();
		if(!reg.test(email)){ //正则验证不通过，格式不对
	　　　　//alert("邮箱地址格式不正确，请重新输入!");
		   ui = '<ul><li>邮箱地址格式不正确，请重新输入!</li></ul>';
		   $('#jsLoginTips').append(ui);
		   $("#username").focus();
	　　　　return false;
	　　}
		$.ajax({
	        type: 'put',
	        //dataType: 'json',
	        //contentType: 'application/json; charset=UTF-8',
	        data: {email:email},//JSON.stringify({email:email}),//formData,
	        url:'${request.contextPath}/sendCaptcha',
	        //traditional : true,
	        async:false,//true为异步，false为同步
	        error: function () {console.log("error");
	            //console.log(output);
	            alert("There was an error processing this page.");
	            return false;
	        },
	        success:function(data){//alert("返回结果："+ data);
	  	        //请求成功时
	        	console.log(data);
	  	        if(data.code != 0){
	  	        	//alert("登录出错：" + data.msg);
	  	        	$('#jsLoginTips').empty();
	  	            var ui = '<ul><li>'+data.msg+'</li></ul>';
	  	            $('#jsLoginTips').append(ui);
	  	            return false;
	  	        }else{
	  	        	settime(obj);
	  	        }
	  	    } 
	    });
	}
	// 提交注册
	function registerSubmit(){
		$('#jsLoginTips').empty();
        var ui = '<ul><li></li></ul>';
        
        var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
		var email=$("#username").val();
		if(!reg.test(email)){ //正则验证不通过，格式不对
	　　　　//alert("邮箱地址格式不正确，请重新输入!");
		   ui = '<ul><li>邮箱地址格式不正确，请重新输入!</li></ul>';
		   $('#jsLoginTips').append(ui);
		   $("#username").focus();
	　　　　return false;
	　　}
		if (document.getElementById("id_captcha_1").value == ''){
            $('#jsLoginTips').empty();
            ui = '<ul><li>验证码不能为空</li></ul>';
            $('#jsLoginTips').append(ui);
            return false;
        }
		
		var password = $("#password").val();
		var password1 = $("#password1").val();
		if(password==''||password1==''){
			$('#jsLoginTips').empty();
			ui = '<ul><li>密码不能为空 !</li></ul>';
			$('#jsLoginTips').append(ui);
			return false;
		}
		if(password!=password1){
			$('#jsLoginTips').empty();
			ui = '<ul><li>两次密码输入不一致，请重新输入!</li></ul>';
			$('#jsLoginTips').append(ui);
			$("#password1").focus();
			return false;
		}
		//alert(JSON.stringify($("#registerForm").serializeObject()));
		$.ajax({
	        type: 'post',
	        dataType: 'json',
	        contentType: 'application/json; charset=UTF-8',
	        data: JSON.stringify($("#registerForm").serializeObject()),//JSON.stringify(getFormData($("#dataForm"))),//formData,
	        url:'${request.contextPath}/register',
	        async:false,//true为异步，false为同步
	        error: function () {console.log("error");
	            //console.log(output);
	            alert("There was an error processing this page.");
	            return false;
	        },
	        success:function(data){//alert("返回结果："+ data);
	  	        //请求成功时
	        	console.log(data);
	  	        if(data.code != 0){
	  	        	//alert("登录出错：" + data.msg);
	  	        	$('#jsLoginTips').empty();
	  	            var ui = '<ul><li>'+data.msg+'</li></ul>';
	  	            $('#jsLoginTips').append(ui);
	  	            return false;
	  	        }else{// 登录成功进入主业
	  	        	alert("注册成功，请用账号【" + email + "】登录！");
	  	        	window.location.href = 'login.html';
	  	        }
	  	    } 
	    });
		
	}
</script>


</body></html>